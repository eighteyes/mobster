<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Document</title>
    <script src="/socket.io/socket.io.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.0/jquery.js"></script>
    <script>
      var socket = io.connect('http://localhost');
      socket.on('init', function(data){
        console.log('init -> ', data);
      });
      socket.on('update', function(data){
        console.log('update -> ', data);
      })


    </script>

    <script>

    navigator.geolocation.getCurrentPosition(positionSuccess);

    var coords;

    function positionSuccess( pos ){
      var cx = pos.coords;
      coords = cx;
      console.log(" > init ", pos);
      socket.emit('init', { userId: 1, lat: cx.latitude, lon: cx.longitude });
    }



      $( function() {
        $(document).on('keypress', function(e){
          if (e.keyCode == 13){
            socket.emit('chat', { userId: 1, msg: $('input:first').val() });
          }
        });

        $('#update').on('click', function(e){
          socket.emit( 'update', { userId: 1, lat: coords.latitude, lon: coords.longitude })
        });

        socket.on('chat', function(data){
          console.log("chat", data);
          $('#chat').append( $('<p>', {text: data.msg} ));
        });
      })
    </script>
</head>
<body>


  <input type="text"><button id="update">Update yo</button>
  <div id="chat">
  </div>

</body>
</html>